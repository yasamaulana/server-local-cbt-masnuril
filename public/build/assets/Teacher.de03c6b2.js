import{u as v,a as _,o as d,c,b,w as g,d as s,t as o,f as M,s as P,L as A,i as w}from"./app.8bde5e17.js";import{L}from"./Student.8552d821.js";import{L as i}from"./leaflet.85e3e899.js";import{a as f}from"./index.d30004a7.js";import{S as h}from"./sweetalert2.all.9e63d2cf.js";import{_ as T}from"./_plugin-vue_export-helper.cdc0426e.js";const I=v({name:"AbsensiSiswa",components:{Link:A},layout:L,props:{teacher:Object,auth:{type:Object,required:!0}},data(){return{latitude:-6.901971,longitude:109.504981,map:null,status:"hadir",allowedRadius:150,centerLat:-6.901971,centerLng:109.504981,hasAbsensiToday:!1}},mounted(){this.checkAbsensiToday(),this.initMap(),this.getPositionFirst()},methods:{async getPositionFirst(){try{const t=await this.getCurrentPosition();this.getPosition(t)}catch(t){this.showError(t)}},getPosition(t){this.latitude=t.coords.latitude,this.longitude=t.coords.longitude,this.updateMap()},async checkAbsensiToday(){try{const t=await f.get("/student/check-absensi-today-teacher");this.hasAbsensiToday=t.data.hasAbsensiToday}catch(t){console.error(t)}},async getLocation(){try{const t=await this.getCurrentPosition();this.showPosition(t)}catch(t){this.showError(t)}},showPosition(t){this.latitude=t.coords.latitude,this.longitude=t.coords.longitude;const e=this.calculateDistance(this.latitude,this.longitude,this.centerLat,this.centerLng);this.status==="hadir"&&e>this.allowedRadius?h.fire({icon:"warning",title:"Peringatan",text:"Anda berada di luar radius yang diizinkan untuk status 'hadir'."}):(this.updateMap(),this.absenMasuk())},getCurrentPosition(){return new Promise((t,e)=>{navigator.geolocation.getCurrentPosition(t,e)})},showError(t){let e="An unknown error occurred.";switch(t.code){case t.PERMISSION_DENIED:e="User denied the request for Geolocation.";break;case t.POSITION_UNAVAILABLE:e="Location information is unavailable.";break;case t.TIMEOUT:e="The request to get user location timed out.";break}h.fire({icon:"error",title:"Error",text:e})},initMap(){this.map&&this.map.remove(),this.map=i.map("map").setView([this.latitude,this.longitude],20),i.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"\xA9 Innovart Development"}).addTo(this.map);const t=i.divIcon({html:`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-geo-alt-fill" viewBox="0 0 16 16">
                        <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10m0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6"/>
                        </svg>`,className:"text-warning",iconSize:[24,24],iconAnchor:[12,24],popupAnchor:[0,-24]});i.marker([this.latitude,this.longitude],{icon:t}).addTo(this.map).bindPopup("Your current location").openPopup(),i.circle([this.centerLat,this.centerLng],{color:"red",fillColor:"#f03",fillOpacity:.5,radius:this.allowedRadius}).addTo(this.map).bindPopup("Allowed radius"),i.circle([this.latitude,this.longitude],{color:"blue",fillColor:"#30f",fillOpacity:.5,radius:10}).addTo(this.map).bindPopup("Your current location")},updateMap(){if(!this.map){this.initMap();return}this.map.setView([this.latitude,this.longitude],20),this.map.eachLayer(e=>{(e instanceof i.Marker||e instanceof i.Circle)&&this.map.removeLayer(e)});const t=i.divIcon({html:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-map-pin"><path d="M21 10c0 6-9 13-9 13S3 16 3 10a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>',className:"",iconSize:[24,24],iconAnchor:[12,24],popupAnchor:[0,-24]});i.marker([this.latitude,this.longitude],{icon:t}).addTo(this.map).bindPopup("Your current location").openPopup(),i.circle([this.centerLat,this.centerLng],{color:"red",fillColor:"#f03",fillOpacity:.5,radius:this.allowedRadius}).addTo(this.map).bindPopup("Allowed radius"),i.circle([this.latitude,this.longitude],{color:"blue",fillColor:"#30f",fillOpacity:.5,radius:100}).addTo(this.map).bindPopup("Your current location")},calculateDistance(t,e,r,u){const p=t*Math.PI/180,l=r*Math.PI/180,n=(r-t)*Math.PI/180,a=(u-e)*Math.PI/180,m=Math.sin(n/2)*Math.sin(n/2)+Math.cos(p)*Math.cos(l)*Math.sin(a/2)*Math.sin(a/2),k=2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m));return 6371e3*k},absenMasuk(){f.post("/student/presence-submit-teacher",{teacher_id:this.teacher.teacher_id,lesson_id:this.teacher.lesson_id,class_id:this.teacher.class_id,latitude:this.latitude,longitude:this.longitude,status:this.status}).then(t=>{h.fire({icon:"success",title:"Absen Berhasil",text:t.data.message}).then(()=>{this.resetData()})}).catch(t=>{console.error(t),alert("Failed to submit attendance.")})},resetData(){this.status="hadir",this.hasAbsensiToday=!0,this.checkAbsensiToday()}}}),S=s("title",null,"Absensi Guru - Aplikasi Ujian Online",-1),C=s("i",{class:"fa fa-long-arrow-alt-left me-2"},null,-1),O=w(" Kembali"),j={class:"card"},x=s("div",{class:"card-title text-center fw-bold text-center"},[s("h3",{class:"mt-2"},"Absensi Guru")],-1),E={key:0,class:"card-body"},D={class:"text-center"},N=s("div",{id:"map",style:{height:"500px","margin-bottom":"20px"}},null,-1),B={class:"text-center"},z=w("Klik tombol di bawah ini untuk melakukan absensi guru, oleh ketua dengan nama "),R={class:"fw-bold"},V={class:"d-flex justify-content-center"},q=s("td",null,"Pengajar ",-1),F={class:"fw-bold"},U=s("td",null,"Mata Pelajaran",-1),H={class:"fw-bold"},Y=s("td",null,"Kelas Mengajar",-1),$={class:"fw-bold"},G=s("td",null,"Hari",-1),K={class:"fw-bold"},J=s("td",null,"Jam Mata Pelajaran",-1),Q={class:"fw-bold"},W={class:"text-center mt-4"},X={class:"mb-3"},Z=s("label",{for:"status",class:"form-label"},"Status",-1),tt=s("option",{value:"hadir"},"Hadir",-1),st=s("option",{value:"izin"},"Izin",-1),et=s("option",{value:"sakit"},"Sakit",-1),it=s("option",{value:"alpha"},"Alpha",-1),at=[tt,st,et,it],ot=["disabled"],nt={key:1,class:"card"},rt=s("div",{class:"card-body"},[s("h4",{class:"text-center"},"Belum ada jadwal tersedia")],-1),lt=[rt];function dt(t,e,r,u,y,p){const l=_("Head"),n=_("Link");return d(),c("div",null,[b(l,null,{default:g(()=>[S]),_:1}),b(n,{href:"/student/dashboard",class:"btn btn-md btn-primary border-0 shadow mb-3",type:"button"},{default:g(()=>[C,O]),_:1}),s("div",j,[x,t.teacher?(d(),c("div",E,[s("div",D,[s("button",{class:"btn btn-primary btn-sm mb-2",onClick:e[0]||(e[0]=(...a)=>t.getPositionFirst&&t.getPositionFirst(...a))},"Lokasi Saya")]),N,s("p",B,[z,s("span",R,o(t.auth.student.name),1)]),s("div",V,[s("table",null,[s("tr",null,[q,s("td",F,": "+o(t.teacher.teacher.name),1)]),s("tr",null,[U,s("td",H,": "+o(t.teacher.lesson.title),1)]),s("tr",null,[Y,s("td",$,": "+o(t.teacher.class.title),1)]),s("tr",null,[G,s("td",K,": "+o(t.teacher.day),1)]),s("tr",null,[J,s("td",Q,": "+o(t.teacher.start_time)+" Sampai "+o(t.teacher.end_time),1)])])]),s("div",W,[s("div",X,[Z,M(s("select",{id:"status","onUpdate:modelValue":e[1]||(e[1]=a=>t.status=a),class:"form-select"},at,512),[[P,t.status]])]),s("button",{disabled:t.hasAbsensiToday,onClick:e[2]||(e[2]=(...a)=>t.getLocation&&t.getLocation(...a)),class:"btn btn-primary"},o(t.hasAbsensiToday?"Sudah Absen":"Absen Masuk"),9,ot)])])):(d(),c("div",nt,lt))])])}const gt=T(I,[["render",dt]]);export{gt as default};
